<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Gioco degli Obblighi</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  label { font-weight: bold; margin-top: 15px; display: block; }
  input[type=password] { width: 100%; padding: 5px; margin-bottom: 10px; font-size: 1em; }
  button { padding: 10px 20px; font-size: 1em; margin-top: 10px; cursor: pointer; }
  #estrazioni { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; max-height: 300px; overflow-y: auto; }
  .estrazione-item { margin-bottom: 8px; }
</style>
</head>
<body>

<h1>Gioco degli Obblighi</h1>

<form id="formObblighi">
  <div id="playersInputs"></div>
  <button type="submit">Salva obblighi</button>
</form>

<button id="startGame" disabled>Estrai obbligo</button>

<div id="estrazioni">
  <h2>Obblighi estratti:</h2>
  <div id="estrazioniList"></div>
</div>

<script>
  const players = [
    "Tommaso", "Michael", "Gianluca", "Peppe", "Alessio", "Vincenzo", "Giulia", "Elisa", "Beatrice"
  ];

  const playersInputs = document.getElementById('playersInputs');
  const form = document.getElementById('formObblighi');
  const startGameBtn = document.getElementById('startGame');
  const estrazioniList = document.getElementById('estrazioniList');

  // Genera input password per ogni obbligo di ogni giocatore
  players.forEach((player, i) => {
    const container = document.createElement('div');
    container.innerHTML = `
      <label>${player} - Obbligo 1:</label>
      <input type="password" name="obbligo_${i}_1" required />
      <label>${player} - Obbligo 2:</label>
      <input type="password" name="obbligo_${i}_2" required />
    `;
    playersInputs.appendChild(container);
  });

  let obblighi = []; // array di stringhe obblighi (18)
  let estratti = []; // array di oggetti {playerRicevente, obbligoTesto} estratti
  let estrazioniFatte = 0;

  form.addEventListener('submit', e => {
    e.preventDefault();
    obblighi = [];
    estratti = [];
    estrazioniFatte = 0;
    estrazioniList.innerHTML = '';

    // Prendo gli obblighi da input (nascosti come password)
    players.forEach((player, i) => {
      const o1 = form.elements[`obbligo_${i}_1`].value.trim();
      const o2 = form.elements[`obbligo_${i}_2`].value.trim();
      obblighi.push(o1);
      obblighi.push(o2);
    });

    // Abilita bottone estrazione
    startGameBtn.disabled = false;
    alert("Obblighi salvati! Puoi iniziare l'estrazione.");
  });

  // Funzione helper per scegliere un elemento casuale da array
  function scegliCasuale(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  startGameBtn.addEventListener('click', () => {
    if (obblighi.length === 0) {
      alert("Prima devi salvare gli obblighi.");
      return;
    }
    if (estrazioniFatte >= obblighi.length) {
      alert("Tutti gli obblighi sono stati estratti.");
      startGameBtn.disabled = true;
      return;
    }

    // Estrai obbligo casuale non ancora estratto
    const obblighiDisponibili = obblighi.filter(o => !estratti.some(e => e.obbligoTesto === o));
    const obbligoEstratto = scegliCasuale(obblighiDisponibili);

    // Estrai giocatore casuale che riceve
    const playerRicevente = scegliCasuale(players);

    // Salva estrazione
    estratti.push({ playerRicevente, obbligoTesto: obbligoEstratto });
    estrazioniFatte++;

    // Mostra sotto obbligo e a chi Ã¨ assegnato
    const div = document.createElement('div');
    div.className = 'estrazione-item';
    div.textContent = `${playerRicevente} riceve l'obbligo: "${obbligoEstratto}"`;
    estrazioniList.appendChild(div);
  });

</script>

</body>
</html>
